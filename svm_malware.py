import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from joblib import dump, load
import numpy as np
from sklearn.svm import SVC



def create_data(num_hidden, data_size):
    # reading csv file and extracting class column to y.
    train = pd.DataFrame.from_csv(r"models_csv\n" + str(num_hidden) + r"\train\train_data_"+str(data_size)+".csv", header=None,
                                  index_col=None)
    num_rows = train.shape[0]
    num_cols = train.shape[1]
    train_np = np.array(train)
    target_train = np.array(train_np[:, num_cols - 1])  # classes having 0 and 1

    train_np = np.array(train_np[:, :num_cols - 1])
    print("------------target train shape-------------------------------------")
    print(target_train.shape)
    print("--------------------train shape-----------------------------")
    print(train_np.shape)
    print("-------------------------------------------------")
    return train_np,target_train

 # "Support Vector Classifier"
def create_svm(k, train_np, target_train, target_names):
    clf = SVC(kernel='linear')
    size_train = len(train_np)
    X_folds = np.array_split(train_np, k)
    y_folds = np.array_split(target_train, k)
    scores = list()
    for k in range(k):
        X_train = list(X_folds)
        X_test = X_train.pop(k)
        X_train = np.concatenate(X_train)
        y_train = list(y_folds)
        y_test = y_train.pop(k)
        y_train = np.concatenate(y_train)
        clf.fit(X_train, y_train)
        score_value = clf.score(X_test, y_test)
        scores.append(score_value)
        fileName = ''
        if(len(target_names)>2):
            fileName = r'svm_models\n'+str(num_hidden)+'\multiClass_n'+str(num_hidden)+'_size_'+str(size_train)+'_k_'+str(k)+'.joblib'
        else:
            fileName = r'svm_models\n'+str(num_hidden)+'binaryClass_n' + str(num_hidden)+'_size_'+str(size_train)+'_k_'+str(k)+'.joblib'
        dump(clf, filename=fileName)
        # clf = load(fileName)
    print("==============================")
    print(scores)


num_hidden = 7
data_size_selection = 200
train_np, target_train = create_data(num_hidden,data_size_selection)
target_names = ["ss", "vigenere", "col"]
create_svm(k=10, train_np=train_np, target_train=target_train, target_names=target_names)